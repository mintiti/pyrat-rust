repos:
  # Generic checks
  -   repo: https://github.com/pre-commit/pre-commit-hooks
      rev: v4.5.0
      hooks:
        -   id: trailing-whitespace
        -   id: end-of-file-fixer
        -   id: check-yaml
        -   id: check-toml
        -   id: check-added-large-files
        -   id: debug-statements

  # Python linting/formatting
  -   repo: https://github.com/astral-sh/ruff-pre-commit
      rev: v0.7.3
      hooks:
        -   id: ruff
            args: [--fix]
            types_or: [python, pyi]
            files: ^(engine/python/|protocol/pyrat_base/|cli/)
        -   id: ruff-format
            types_or: [python, pyi]
            files: ^(engine/python/|protocol/pyrat_base/|cli/)

  # Python type checking - run same as CI for consistency
  -   repo: local
      hooks:
        -   id: mypy-protocol
            name: mypy protocol
            description: Type check protocol package (matches CI)
            entry: uv run --directory protocol/pyrat_base mypy pyrat_base --ignore-missing-imports
            language: system
            pass_filenames: false
            files: ^protocol/pyrat_base/
            types: [python]

        -   id: mypy-engine
            name: mypy engine
            description: Type check engine package (matches CI)
            entry: uv run --directory engine mypy python/pyrat_engine --ignore-missing-imports
            language: system
            pass_filenames: false
            files: ^engine/python/
            types: [python]

        -   id: mypy-cli
            name: mypy CLI
            description: Type check CLI package (matches CI)
            entry: uv run --directory cli mypy pyrat_runner --ignore-missing-imports
            language: system
            pass_filenames: false
            files: ^cli/
            types: [python]

  # Rust checks
  -   repo: local
      hooks:
        -   id: fmt
            name: cargo fmt
            description: Format Rust code
            entry: bash -c 'cargo fmt --all'
            language: system
            types: [rust]
            pass_filenames: false

        -   id: clippy
            name: cargo clippy
            description: Lint Rust code
            entry: bash -c 'cargo clippy --all-targets --all-features -- -D warnings -A non-local-definitions'
            language: system
            types: [rust]
            pass_filenames: false

  # Tests
  -   repo: local
      hooks:
        -   id: pytest-engine
            name: pytest engine
            entry: uv run --directory engine pytest python/tests
            language: system
            pass_filenames: false
            always_run: true
            stages: [pre-push]  # Only run on push, not on every commit

        -   id: pytest-protocol
            name: pytest protocol
            entry: uv run --directory protocol/pyrat_base pytest tests -n auto -m "not slow"
            language: system
            pass_filenames: false
            always_run: true
            stages: [pre-push]  # Only run on push, not on every commit

        -   id: pytest-cli
            name: pytest CLI
            entry: uv run pytest cli/tests
            language: system
            pass_filenames: false
            always_run: true
            stages: [pre-push]  # Only run on push, not on every commit
